import { useState } from "react";
import { motion } from "framer-motion";
import { CheckCircle2, School, Users, Map, Clock, Shield, Download, PlayCircle, Github, Mail } from "lucide-react";

// -------- Helpers (GH Pages-safe asset paths + tiny dev tests) --------
function withBase(path: string) {
  const base = (import.meta as any)?.env?.BASE_URL || "/";
  return base + path.replace(/^\//, "");
}

export function getScreenUrl(i: number) {
  if (!Number.isInteger(i) || i < 1 || i > 12) {
    throw new Error("getScreenUrl: i must be an integer between 1 and 12");
  }
  return withBase(`screens/screen-${i}.png`);
}

// Basic dev tests
if (typeof window !== "undefined" && (import.meta as any)?.env?.DEV) {
  try {
    console.assert(getScreenUrl(1).endsWith("/screens/screen-1.png"));
    console.assert(getScreenUrl(6).endsWith("/screens/screen-6.png"));
  } catch (e) {
    console.error("Test failed", e);
  }
}

const Container = ({ children }: { children: React.ReactNode }) => (
  <div className="mx-auto w-full max-w-6xl px-4 sm:px-6 lg:px-8">{children}</div>
);

const Badge = ({ children }: { children: React.ReactNode }) => (
  <span className="inline-flex items-center rounded-full border border-gray-200 bg-white/70 px-3 py-1 text-xs font-medium backdrop-blur">
    {children}
  </span>
);

const Button = ({ children, href }: { children: React.ReactNode; href?: string }) => (
  <a
    href={href || "#"}
    className="inline-flex items-center gap-2 rounded-2xl border border-transparent bg-black px-5 py-3 text-white shadow-md transition hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-black/30"
  >
    {children}
  </a>
);

const GhostButton = ({ children, href }: { children: React.ReactNode; href?: string }) => (
  <a
    href={href || "#"}
    className="inline-flex items-center gap-2 rounded-2xl border border-gray-300 bg-white px-5 py-3 text-gray-900 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-black/10"
  >
    {children}
  </a>
);

const SectionTitle = ({ kicker, title, subtitle }: { kicker?: string; title: string; subtitle?: string }) => (
  <div className="mb-10 text-center">
    {kicker && <div className="mb-3 text-sm font-semibold uppercase tracking-widest text-gray-500">{kicker}</div>}
    <h2 className="text-3xl font-bold leading-tight sm:text-4xl">{title}</h2>
    {subtitle && <p className="mx-auto mt-3 max-w-2xl text-gray-600">{subtitle}</p>}
  </div>
);

export default function DersYolumLanding() {
  const [playing, setPlaying] = useState(false);

  return (
    <div className="min-h-screen bg-gradient-to-b from-white to-gray-50 text-gray-900">
      {/* Nav */}
      <header className="sticky top-0 z-40 border-b border-gray-100 bg-white/70 backdrop-blur">
        <Container>
          <div className="flex h-16 items-center justify-between">
            <a href="#" className="flex items-center gap-2 font-bold">
              <div className="grid h-8 w-8 place-items-center rounded-xl bg-black text-white">DY</div>
              <span>Ders Yolum</span>
            </a>
            <nav className="hidden items-center gap-6 text-sm font-medium md:flex">
              <a href="#features" className="hover:text-black">Ã–zellikler</a>
              <a href="#screens" className="hover:text-black">Ekran GÃ¶rÃ¼ntÃ¼leri</a>
              <a href="#faq" className="hover:text-black">SSS</a>
              <a href={withBase('support.html')} className="hover:text-black">Destek</a>
            </nav>
            <div className="flex items-center gap-3">
              <GhostButton href="https://github.com/azizturhan/dersyolum-site">
                <Github className="h-4 w-4" /> Kaynak Kodu
              </GhostButton>
              <Button href="#download">
                <Download className="h-4 w-4" /> Ä°ndir
              </Button>
            </div>
          </div>
        </Container>
      </header>

      {/* Hero */}
      <section className="relative overflow-hidden pb-16 pt-16 sm:pb-24 sm:pt-24">
        <Container>
          <div className="grid items-center gap-10 md:grid-cols-2">
            <div>
              <div className="mb-4 flex items-center gap-2">
                <Badge>Ã–ÄŸretmen odaklÄ±</Badge>
                <Badge>Offline Ã§alÄ±ÅŸma</Badge>
                <Badge>Firebase destekli</Badge>
              </div>
              <h1 className="text-4xl font-extrabold tracking-tight sm:text-5xl">
                Ã–ÄŸretmen, Ã¶ÄŸrenci ve veli iÃ§in <span className="underline decoration-black/20">akÄ±llÄ±</span> Ã¶ÄŸrenme deneyimi
              </h1>
              <p className="mt-4 max-w-xl text-lg text-gray-600">
                Ders Yolum; kazanÄ±m takibi, Ã¶dev ve sÄ±nav yÃ¶netimi, offline Ã§Ã¶zÃ¼mler ve anlÄ±k bildirimlerle okul iletiÅŸimini tek bir uygulamada toplar.
              </p>
              <div className="mt-8 flex flex-wrap items-center gap-3">
                <Button href="#download"><Download className="h-4 w-4" /> Hemen Ä°ndir</Button>
                <GhostButton href="#features"><CheckCircle2 className="h-4 w-4" /> Ã–zelliklere Bak</GhostButton>
              </div>
              <p className="mt-3 text-xs text-gray-500">iOS ve Android destekli â€¢ ReklamsÄ±z eÄŸitim modu â€¢ TÃ¼rkÃ§e</p>
            </div>
            <motion.div
              initial={{ opacity: 0, y: 30 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ duration: 0.6 }}
              className="relative"
            >
              <div className="relative rounded-2xl border border-gray-200 bg-white p-2 shadow-xl">
                <div className="aspect-[9/16] w-full overflow-hidden rounded-xl bg-gray-100">
                  {!playing ? (
                    <button
                      onClick={() => setPlaying(true)}
                      className="grid h-full w-full place-items-center"
                      aria-label="TanÄ±tÄ±m videosu oynat"
                    >
                      <div className="flex flex-col items-center">
                        <PlayCircle className="h-16 w-16" />
                        <span className="mt-2 text-sm text-gray-600">TanÄ±tÄ±m videosu</span>
                      </div>
                    </button>
                  ) : (
                    <video className="h-full w-full object-cover" controls autoPlay playsInline>
                      <source src={withBase("promo.mp4")} type="video/mp4" />
                    </video>
                  )}
                </div>
              </div>
            </motion.div>
          </div>
        </Container>
      </section>

      {/* Features */}
      <section id="features" className="py-16 sm:py-24">
        <Container>
          <SectionTitle
            kicker="Ã–zellikler"
            title="Ders Yolum ile neler yapabilirsiniz?"
            subtitle="Okul ekosistemindeki her role uygun gÃ¼Ã§lÃ¼ modÃ¼ller."
          />
          <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            <Feature icon={<School className="h-5 w-5" />} title="KazanÄ±m Takibi" desc="Haftalara bÃ¶lÃ¼nmÃ¼ÅŸ kazanÄ±m gÃ¶rÃ¼nÃ¼mÃ¼ ile planlÄ± ilerleyin." />
            <Feature icon={<Users className="h-5 w-5" />} title="SÄ±nÄ±f & Veli Ä°letiÅŸimi" desc="Duyurular, Ã¶devler ve sohbet ile anÄ±nda bilgilendirme." />
            <Feature icon={<Clock className="h-5 w-5" />} title="Offline SÄ±nav Ã‡Ã¶zme" desc="SorularÄ± indirip internet olmadan Ã§Ã¶zÃ¼n, sonra senkronlayÄ±n." />
            <Feature icon={<Map className="h-5 w-5" />} title="Servis Takibi (opsiyonel)" desc="Ã–ÄŸrenci/personel servis takibi ve yoklama entegrasyonu." />
            <Feature icon={<Shield className="h-5 w-5" />} title="GÃ¼venli AltyapÄ±" desc="Firebase kimlik doÄŸrulama, bildirim ve Remote Config desteÄŸi." />
            <Feature icon={<CheckCircle2 className="h-5 w-5" />} title="Kolay Kurulum" desc="Okul, Ã¶ÄŸretmen ve sÄ±nÄ±f kurulumlarÄ±nÄ± dakikalar iÃ§inde tamamlayÄ±n." />
          </div>
        </Container>
      </section>

      {/* Screenshots */}
      <section id="screens" className="bg-white py-16 sm:py-24">
        <Container>
          <SectionTitle title="Ekran GÃ¶rÃ¼ntÃ¼leri" subtitle="MaÄŸaza ve sosyal medya iÃ§in yÃ¼ksek kaliteli gÃ¶rseller." />
          <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {[1,2,3,4,5,6].map((i) => (
              <div key={i} className="overflow-hidden rounded-2xl border border-gray-200 bg-gray-50 shadow-sm">
                <div
                  className="aspect-[9/16] bg-cover bg-center"
                  style={{ backgroundImage: `url(${getScreenUrl(i)})` }}
                  data-testid={`screen-${i}`}
                />
              </div>
            ))}
          </div>
        </Container>
      </section>

      {/* Download */}
      <section id="download" className="py-16 sm:py-24">
        <Container>
          <SectionTitle title="Ä°ndir & BaÅŸla" subtitle="Ders Yolum Ã¼cretsizdir. Okulunuz iÃ§in kurulum ve destek talep edebilirsiniz." />
          <div className="flex flex-wrap items-center justify-center gap-4">
            <StoreBadge platform="Google Play" href="#" />
            <StoreBadge platform="App Store" href="#" />
          </div>
          <p className="mt-4 text-center text-sm text-gray-500">Kurumsal kurulum iÃ§in iletiÅŸim: <a className="underline" href="mailto:info@dersyolum.app">info@dersyolum.app</a></p>
        </Container>
      </section>

      {/* FAQ */}
      <section id="faq" className="bg-white py-16 sm:py-24">
        <Container>
          <SectionTitle kicker="SSS" title="SÄ±kÃ§a Sorulan Sorular" />
          <div className="grid gap-6 sm:grid-cols-2">
            <Faq q="Uygulama offline Ã§alÄ±ÅŸÄ±r mÄ±?" a="Evet. SÄ±nav Ã§Ã¶zme ve iÃ§erik gÃ¶rÃ¼ntÃ¼leme modÃ¼lleri internet olmadan kullanÄ±labilir; baÄŸlantÄ± geldiÄŸinde veriler senkronlanÄ±r." />
            <Faq q="Okul kurulumunu nasÄ±l yapacaÄŸÄ±z?" a="Okul ve branÅŸ Ã¶ÄŸretmenlerini panele ekleyip sÄ±nÄ±flarÄ± oluÅŸturmanÄ±z yeterli. Veli uygulamasÄ±yla eÅŸleÅŸtirme yapÄ±lÄ±r." />
            <Faq q="Verilerimiz gÃ¼vende mi?" a="Kimlik doÄŸrulama, yetkilendirme ve veritabanÄ± kurallarÄ± Firebase Ã¼zerinde gÃ¼venli ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r." />
            <Faq q="Kendi logomuzu kullanabilir miyiz?" a="Evet. Kurumsal kurulumlarda okul/kurum logonuzla Ã¶zelleÅŸtirme yapÄ±labilir." />
          </div>
        </Container>
      </section>

      {/* Support */}
      <section id="support" className="bg-white py-16 sm:py-24">
        <Container>
          <SectionTitle kicker="Destek" title="YardÄ±ma mÄ± ihtiyacÄ±nÄ±z var?" subtitle="Herhangi bir sorunuzda bizimle iletiÅŸime geÃ§ebilirsiniz." />
          <div className="flex flex-col items-center gap-4 text-center">
            <Mail className="h-10 w-10 text-gray-700" />
            <p className="text-lg font-medium">ðŸ“§ dersyolumdestek@gmail.com</p>
            <p className="text-sm text-gray-600">SorularÄ±nÄ±zÄ± bize e-posta yoluyla iletebilirsiniz. En kÄ±sa sÃ¼rede yanÄ±t vereceÄŸiz.</p>
          </div>
        </Container>
      </section>

      {/* Footer */}
      <footer className="border-t border-gray-200 bg-gray-50 py-10 text-sm">
        <Container>
          <div className="flex flex-col items-center justify-between gap-4 sm:flex-row">
            <p>Â© {new Date().getFullYear()} Ders Yolum â€¢ TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
            <div className="flex items-center gap-4">
              <a href="#" className="hover:underline">Gizlilik</a>
              <a href="#" className="hover:underline">KullanÄ±m ÅžartlarÄ±</a>
              <a href="https://github.com/azizturhan/dersyolum-site" className="inline-flex items-center gap-1 hover:underline"><Github className="h-4 w-4" /> GitHub</a>
            </div>
          </div>
        </Container>
      </footer>
    </div>
  );
}

function Feature({ icon, title, desc }: { icon: React.ReactNode; title: string; desc: string }) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 16 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true }}
      transition={{ duration: 0.4 }}
      className="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
    >
      <div className="mb-3 inline-flex h-10 w-10 items-center justify-center rounded-xl border border-gray-200 bg-gray-50">
        {icon}
      </div>
      <h3 className="text-lg font-semibold">{title}</h3>
      <p className="mt-1 text-gray-600">{desc}</p>
    </motion.div>
  );
}

function Faq({ q, a }: { q: string; a: string }) {
  return (
    <div className="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
      <h4 className="font-semibold">{q}</h4>
      <p className="mt-2 text-gray-600">{a}</p>
    </div>
  );
}

function StoreBadge({ platform, href }: { platform: string; href: string }) {
  const imgSrc = platform === "Google Play" ? withBase("badges/google-play.svg") : withBase("badges/app-store.svg");
  return (
    <a href={href} className="inline-flex items-center gap-3 rounded-xl border border-gray-200 bg-white px-4 py-3 shadow-sm hover:bg-gray-50">
      <img
        src={imgSrc}
        alt={`${platform} badge`}
        className="h-8 w-auto"
      />
      <div className="text-left">
        <div className="text-[10px] leading-3 text-gray-500">Åžuradan edinin</div>
        <div className="-mt-0.5 text-sm font-semibold">{platform}</div>
      </div>
    </a>
  );
}
